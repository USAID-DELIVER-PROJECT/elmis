<!--
  ~ Electronic Logistics Management Information System (eLMIS) is a supply chain management system for health commodities in a developing country setting.
  ~
  ~ Copyright (C) 2015  John Snow, Inc (JSI). This program was produced for the U.S. Agency for International Development (USAID). It was prepared under the USAID | DELIVER PROJECT, Task Order 4.
  ~
  ~ This program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.
  ~
  ~ This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License for more details.
  ~
  ~ You should have received a copy of the GNU Affero General Public License along with this program.  If not, see <http://www.gnu.org/licenses/>.
  -->
<div ng-controller="CreateEquipmentLineItemController">
  <div>
    {{rnr.equipmentErrorMessage}}
    </div>
    <div class="rnr-table regimen-table" tab-scroll bottom-offset="180">
        <table id="equipmentTable" fixed-table-header class="table table-bordered scrollable">
            <thead>
            <tr>
                <th class="col-product" >
                    <div class="regimen-heading">
                        <span openlmis-message="rnr.equipment.equipment.name"></span>
                    </div>
                </th>
                <th class="span3" >
                    <div class="regimen-heading">
                        <span openlmis-message="rnr.label.non.functional.test.types"></span>
                    </div>
                </th>
                <th class="span3" >
                    <div class="regimen-heading">
                        <span  openlmis-message="rnr.label.no.days.not.functional"></span>
                    </div>
                </th>
                <th class="span3" >
                    <div class="regimen-heading">
                        <span openlmis-message="rnr.label.no.of.test.done"></span>
                    </div>
                </th>
                <th class="col-remarks" >
                    <div class="regimen-heading">
                        <span openlmis-message="rnr.equipment.remarks"></span>
                    </div>
                </th>
            </tr>
            </thead>
            <tbody >

            <tr>
                <td class="productCategory" colspan="5" openlmis-message="rnr.label.bio.chemistry.equipment"></td>
            </tr>
            <tr ng-repeat="equipmentLineItem in bioChemistryLineItem = (page.equipment | filter:{isBioChemistryEquipment: true}) ">

                <td class="cell-input padding2px ">
                  <span class="col-product cell-text">
                     <span ng-bind="equipmentLineItem.equipmentName" class="padding2px"></span>
                  </span>
                </td>
                <td class="cell-input padding2px">
                    <div class="btn-group dropdown">
                        <button id="non-functional-types" type="button"
                                class="btn btn-default dropdown-toggle btn-mini"
                                openlmis-message="rnr.label.select.non.functional.test.type">
                                <span openlmis-message="rnr.label.select.non.functional.test.type"></span>
                                <span class="caret"></span>
                        </button>
                        <ul onclick="event.stopPropagation();" class="dropdown-menu" style="min-width:210px;">
                            <li>
                                <label class="checkbox" >
                                    <input type="checkbox" ng-disabled="formDisabled || equipmentLineItem.isObsolete"
                                           style="visibility: visible !important;"
                                           ng-init="equipmentLineItem.electrolytesChecked = equipmentLineItem.electrolytesDaysOutOfUse > 0"
                                           ng-checked="equipmentLineItem.electrolytesChecked && !equipmentLineItem.isObsolete"
                                           ng-model="equipmentLineItem.electrolytesChecked"/>
                                    <span openlmis-message="rnr.label.electrolytes"></span>
                                </label>
                            </li>
                            <li>
                                <label class="checkbox">
                                <input type="checkbox" ng-disabled="formDisabled || equipmentLineItem.isObsolete"
                                       style="visibility: visible !important;"
                                       ng-init="equipmentLineItem.analytesChecked  = (equipmentLineItem.analytesDaysOutOfUse > 0)"
                                       ng-checked="equipmentLineItem.analytesChecked && !equipmentLineItem.isObsolete"
                                       ng-model="equipmentLineItem.analytesChecked"/>
                                        <span openlmis-message="rnr.label.analytes"></span>
                                </label>
                            </li>
                            <li>
                                <label class="checkbox" >
                                    <input type="checkbox" ng-disabled="formDisabled" id="equipmentLineItem_$index"
                                           style="visibility: visible !important;"
                                           ng-init="equipmentLineItem.isObsolete = equipmentLineItem.operationalStatus.isObsolete;"
                                           ng-model="equipmentLineItem.isObsolete"
                                           ng-change="setEquipmentLineItemStatusObsolete(equipmentLineItem);"/>
                                    <span openlmis-message="label.obsolete.equipment.status"></span>
                                </label>
                            </li>
                        </ul>
                    </div>
                </td>
                <td class="padding2px cell-input ">
                    <div class="btn-group dropdown" >
                        <button id="non-functional-days" type="button" ng-class="{'error-border' : !equipmentLineItem.isEquipmentValid}"
                                class="btn btn-default dropdown-toggle btn-mini">
                            <span openlmis-message="rnr.label.days.not.functional"></span>
                            <span class="caret"></span>
                        </button>
                        <ul onclick="event.stopPropagation();" class="dropdown-menu wide">
                            <li>
                                <div class="row" >
                                    <div class="span2">
                                        <label class="drop-label" style="font-size: 10px;"
                                                      for="{{equipmentLineItem.equipmentName}}_electrolytes">
                                            <span openlmis-message="rnr.label.electrolytes"></span>
                                        </label>
                                    </div>
                                    <div class="span2">
                                        <input  type="text" id="{{equipmentLineItem.equipmentName}}_electrolytes"
                                               ng-disabled="formDisabled || !equipmentLineItem.electrolytesChecked || equipmentLineItem.isObsolete"
                                               numeric-validator="positiveInteger"
                                               ng-model="equipmentLineItem.electrolytesDaysOutOfUse"
                                               ng-class="{'required-error' : validateDaysOutOfUse(equipmentLineItem, equipmentLineItem.electrolytesDaysOutOfUse)}">
                                    </div>
                                </div>
                            </li>
                            <li>
                                <div class="row" >
                                    <div class="span2">
                                        <label class="drop-label" style="font-size: 10px;"
                                               for="{{equipmentLineItem.equipmentName}}_analytes">
                                            <span openlmis-message="rnr.label.analytes"></span>
                                        </label>
                                    </div>
                                    <div class="span2">
                                        <input type="text" id="{{equipmentLineItem.equipmentName}}_analytes"
                                               ng-disabled="formDisabled || !equipmentLineItem.analytesChecked || equipmentLineItem.isObsolete"
                                               numeric-validator="positiveInteger"
                                               ng-model="equipmentLineItem.analytesDaysOutOfUse"
                                               ng-class="{'required-error' : validateDaysOutOfUse(equipmentLineItem, equipmentLineItem.analytesDaysOutOfUse)}">
                                     </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </td>
                <td class="cell-input">
                    <div class="btn-group dropdown" uib-dropdown="" is-open="status.isopen">
                        <button id="tests-done" type="button" class="btn btn-default dropdown-toggle btn-mini">
                            &nbsp;<span openlmis-message="rnr.label.test.done"></span> <span class="caret"></span>
                        </button>
                        <ul onclick=" event.stopPropagation();" class="dropdown-menu wide scroll">
                            <li ng-repeat="(key, value) in equipmentLineItem.bioChemistryTestes | groupBy: 'testTypeName'">
                                <div class="row"><strong>{{key}}</strong> <hr style="margin: 4px 0;"/></div>

                                <div class="row" ng-repeat="testCount in value">
                                    <div class="span2">
                                        <label class="drop-label" style="font-size: 10px;"
                                               for="{{equipmentLineItem.equipmentName}}_{{testCount.productName}}">
                                            {{testCount.productName}}</label>
                                    </div>
                                    <div class="span2">
                                        <input type="text"
                                               ng-disabled="formDisabled" numeric-validator="positiveInteger"
                                               id="{{equipmentLineItem.equipmentName}}_{{testCount.productName}}"
                                               ng-model="testCount.numberOfTestes" >
                                        <span ng-show=""><br/>Error</span>
                                </div>
                            </li>
                        </ul>
                    </div>
                </td>
                <td class="cell-input" >
                  <span  ng-class="{'cell-error-highlight': (requiresRemarks(equipmentLineItem))}"
                         class="input-error-parent-cell" >
                        <input ng-disabled="formDisabled"  type="text" ng-model="equipmentLineItem.remarks">
                  </span>
                    <span class="alert alert-warning warning-alert"
                            ng-show="requiresRemarks(equipmentLineItem)"
                            openlmis-message="equipment.error.related.products.ordered">
                  </span>
                </td>
            </tr>

            <tr ng-show="bioChemistryLineItem.length == 0">
                <td  colspan="5">
                    <span class="padding2px alert alert-info span12" >
                        <small>
                            <span openlmis-message="rnr.label.no.bio.chemistry.exist"></span></small></span>
                </td>
            </tr>
            <tr>
                <td class="productCategory" colspan="5" openlmis-message="rnr.label.all.other.equipment.types"></td>
            </tr>

            <tr ng-repeat="equipmentLineItem in otherEquipment = (page.equipment | filter:{isBioChemistryEquipment: false}) ">
                <td class="cell-input padding2px ">{{equipmentLineItem.isEquipmentValid}}
                  <span class="col-product cell-text">
                     <span ng-bind="equipmentLineItem.equipmentName" class="padding2px"></span>
                  </span>
                </td>
                <td class="cell-input padding2px">
                    <select ng-disabled="formDisabled" class="cell-text"
                            ng-model="equipmentLineItem.operationalStatusId"
                            ng-change="equipmentStatusChanged(equipmentLineItem);">
                        <option  ng-repeat="status in equipmentOperationalStatus" value="{{status.id}}"
                                 ng-selected="equipmentLineItem.operationalStatusId == status.id">{{status.name}}</option>
                    </select>
                </td>

                <td class="cell-input col-general padding2px" >
                  <span  ng-class="{'cell-error-highlight': (requiresRemarks(equipmentLineItem))}"
                         class="input-error-parent-cell" >
                    <input ng-disabled="formDisabled" type="text" ng-model="equipmentLineItem.daysOutOfUse">
                  </span>
                  </span>
                </td>
                <td class="cell-input col-general padding2px" >
                    <input ng-disabled="formDisabled"  ng-disable="disableForm || !equipmentLineItem.enableTestCount" type="text" ng-model="equipmentLineItem.testCount">
                </td>
                <td class="cell-input" >
                  <span  ng-class="{'cell-error-highlight': (requiresRemarks(equipmentLineItem))}" class="input-error-parent-cell" >
                    <input ng-disabled="formDisabled"  type="text" ng-model="equipmentLineItem.remarks">
                  </span>
                    <span
                            class="alert alert-warning warning-alert"
                            ng-show="requiresRemarks(equipmentLineItem)"
                            openlmis-message="equipment.error.related.products.ordered">
                  </span>
                </td>
            </tr>
            <tr ng-show="otherEquipment.length == 0">
                <td  colspan="5">
                    <span class="padding2px alert alert-info span12" >
                        <small>
                            <span openlmis-message="rnr.label.no.other.equipment"></span>
                        </small>
                    </span>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
</div>

