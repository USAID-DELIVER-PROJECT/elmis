<!--
  ~ Electronic Logistics Management Information System (eLMIS) is a supply chain management system for health commodities in a developing country setting.
  ~
  ~ Copyright (C) 2015  John Snow, Inc (JSI). This program was produced for the U.S. Agency for International Development (USAID). It was prepared under the USAID | DELIVER PROJECT, Task Order 4.
  ~
  ~ This program is free software: you can redistribute it and/or modify it under the terms of the GNU Affero General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.
  ~
  ~ This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU Affero General Public License for more details.
  ~
  ~ You should have received a copy of the GNU Affero General Public License along with this program.  If not, see <http://www.gnu.org/licenses/>.
  -->
<div ng-controller="ViewEquipmentLineItemController">
    <div class="rnr-table regimen-table" tab-scroll bottom-offset="180">
        <table id="equipment-line-item-table" fixed-table-header class="table table-bordered scrollable">
            <thead>
            <tr>
                <th class="col-product" >
                    <div class="regimen-heading">
                        <span openlmis-message="rnr.equipment.equipment.name"></span>
                    </div>
                </th>
                <th class="span3" >
                    <div class="regimen-heading">
                        <span openlmis-message="rnr.label.non.functional.test.types"></span>
                    </div>
                </th>
                <th class="span3" >
                    <div class="regimen-heading">
                        <span  openlmis-message="rnr.label.no.days.not.functional"></span>
                    </div>
                </th>
                <th class="span3" >
                    <div class="regimen-heading">
                        <span openlmis-message="rnr.label.no.of.test.done"></span>
                    </div>
                </th>
                <th class="col-remarks" >
                    <div class="regimen-heading">
                        <span openlmis-message="rnr.equipment.remarks"></span>
                    </div>
                </th>
            </tr>
            </thead>
            <tbody >
            <tr ng-repeat-start="(key, values) in page.equipment | groupBy : 'equipmentTypeCategory'">
                <td class="productCategory" colspan="5">{{key === 'undefined' ? 'All Other Equipment Types' : key}}</td>
            </tr>
            <tr ng-repeat="equipmentLineItem in values" ng-repeat-end>
                <td class="cell-input padding2px ">
                  <span class="col-product cell-text">
                     <span ng-bind="equipmentLineItem.equipmentName" class="padding2px"></span>
                  </span>
                </td>
                <!-- Non Functional Test Types -->
                <td class="cell-input padding2px">
                    <div ng-if="equipmentLineItem.nonFunctionalDaysOutOfUse.length > 1"  class="btn-group dropdown">
                        <button id="non-functional-types_{{equipmentLineItem.id}}" type="button"
                                class="btn btn-default dropdown-toggle btn-mini"
                                openlmis-message="rnr.label.select.non.functional.test.type">
                            <span openlmis-message="rnr.label.select.non.functional.test.type"></span>
                            <span class="caret"></span>
                        </button>
                        <ul onclick="event.stopPropagation();" class="dropdown-menu" style="min-width:210px;">
                            <li ng-repeat="functionalTestTypes in equipmentLineItem.nonFunctionalDaysOutOfUse">
                                <label class="checkbox" >
                                    <input type="checkbox" ng-disabled="true" style="visibility: visible !important;" ng-model="functionalTestTypes.nonFunctional"/>
                                    <span>{{functionalTestTypes.functionalTestName}}</span>
                                </label>
                            </li>
                            <li>
                                <label class="checkbox" >
                                    <input type="checkbox" ng-disabled="true"
                                           style="visibility: visible !important;"
                                           ng-model="equipmentLineItem.isObsolete"/>
                                    <span openlmis-message="label.obsolete.equipment.status"></span>
                                </label>
                            </li>
                        </ul>
                    </div>
                    <span ng-if="equipmentLineItem.nonFunctionalDaysOutOfUse.length == 1 || equipmentLineItem.nonFunctionalDaysOutOfUse.length == undefined">
                <select ng-disabled="true" class="cell-text"
                        ng-model="equipmentLineItem.operationalStatusId">
                    <option  ng-repeat="status in equipmentOperationalStatus" value="{{status.id}}"
                             ng-selected="equipmentLineItem.operationalStatusId == status.id">{{status.name}}</option>
                </select>
            </span>


                </td>
                <!-- No. Days Not Functional -->
                <td class="padding2px cell-input ">
                    <div ng-if="equipmentLineItem.nonFunctionalDaysOutOfUse.length > 1" class="btn-group dropdown" >
                        <button id="non-functional-days_{{equipmentLineItem.id}}" type="button" class="btn btn-default dropdown-toggle btn-mini">
                            <span openlmis-message="rnr.label.days.not.functional"></span>
                            <span class="caret"></span>
                        </button>
                        <ul onclick="event.stopPropagation();" class="dropdown-menu wide">
                            <li ng-repeat="functionalTestTypes in equipmentLineItem.nonFunctionalDaysOutOfUse">
                                <div class="row" >
                                    <div class="span2">
                                        <label class="drop-label" style="font-size: 10px;"
                                               for="{{equipmentLineItem.equipmentName}}_$index">
                                            <span>{{functionalTestTypes.functionalTestName}}</span>
                                        </label>
                                    </div>
                                    <div class="span2">
                                        <input  type="text" id="{{equipmentLineItem.equipmentName}}_$index"
                                                ng-disabled="true"
                                                ng-model="functionalTestTypes.daysOutOfuse">
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                    <div ng-if="equipmentLineItem.nonFunctionalDaysOutOfUse.length == 1">
                        <input style="width: 90%;" ng-disabled="true" type="text" ng-model="equipmentLineItem.nonFunctionalDaysOutOfUse[0].daysOutOfuse">
                    </div>
                    <div ng-if="equipmentLineItem.nonFunctionalDaysOutOfUse == undefined">
                        <input style="width: 90%;" ng-disabled="true" type="text" ng-model="equipmentLineItem.daysOutOfUse">
                    </div>
                </td>
                <!---- 	No. of Test Done -->
                <td class="cell-input">
                    <div ng-if="equipmentLineItem.testDone.length > 1" class="btn-group dropdown" uib-dropdown="" is-open="status.isopen">
                        <button id="test_done_{{equipmentLineItem.id}}" type="button" class="btn btn-default dropdown-toggle btn-mini">
                            &nbsp;<span openlmis-message="rnr.label.test.done"></span> <span class="caret"></span>
                        </button>
                        <ul onclick=" event.stopPropagation();" class="dropdown-menu wide scroll">
                            <li ng-repeat="(key, value) in equipmentLineItem.testDone | groupBy: 'testTypeName'">
                                <div class="row"><strong>{{key}}</strong> <hr style="margin: 4px 0;"/></div>

                                <div class="row" ng-repeat="testDone in value">
                                    <div class="span2">
                                        <label class="drop-label" style="font-size: 10px;">
                                            {{testDone.testItemName}}</label>
                                    </div>
                                    <div class="span2">
                                        <input type="text"  ng-disabled="true" ng-model="testDone.numberOfTestes" >
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                    <div  ng-if="equipmentLineItem.testDone.length == 1" class="cell-input col-general padding2px">
                        <input ng-disabled="true"  ng-disable="true" type="text" ng-model="equipmentLineItem.testDone[0].numberOfTestes">
                    </div>

                    <div  ng-if="equipmentLineItem.testDone == undefined" class="cell-input col-general padding2px">
                        <input ng-disabled="true"  ng-disable="true" type="text" ng-model="equipmentLineItem.testCount">
                    </div>
                </td>
                <td class="cell-input" >
                  <span>
                        <input ng-disabled="true"  type="text" ng-model="equipmentLineItem.remarks">
                  </span>
                    <span class="alert alert-warning warning-alert"
                          ng-show="requiresRemarks(equipmentLineItem)"
                          openlmis-message="equipment.error.related.products.ordered">
                  </span>
                </td>
            </tr>

            </tbody>
        </table>
    </div>
</div>
